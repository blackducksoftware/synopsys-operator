# Perceptor-protoform: a cloud native administration utility for Black Duck ecosystem components:

- perceptor
- perceivers (openshift, kube, ..., )
- perceptor-image-facade
- perceptor-scanner
- blackduck hub

# Quick start

## Preconditions

 - have `kubectl` or `oc` set up and configured

## Steps

 - Clone this repo

```
git clone git@github.com:blackducksoftware/perceptor-protoform.git
cd perceptor-protoform
```

### Kubernetes

 - find the deploy script

```
cd install/kube
```

 - run the script

```
./install.sh my-favorite-namespace <your_favorite_hub_registration_key> master
```

 - create a Hub

```
kubectl create -f ../../examples/hub.yaml
```

 - create an OpsSight instance

```
kubectl create -f ../../examples/opssight.yaml
```

 - create an alert instance

```
kubectl create -f ../../examples/alert.yaml
```

 ### OpenShift

 - find the deploy script

```
cd install/openshift
```

 - run the script

```
./install.sh my-favorite-namespace <your_favorite_hub_registration_key> master
```

 - create a Hub

```
oc create -f ../../examples/hub.yaml
```

 - create an OpsSight instance

```
oc create -f ../../examples/opssight.yaml
```

 - create an alert instance

```
oc create -f ../../examples/alert.yaml
```

# Tested Cluster Versions

Protoform has been run against the following clusters:

- Kubernetes 1.9.1 and 1.10
- Openshift Origin 3.6, 3.7, 3.9, 3.10

# Prerequisites

The user running the installation should be able to create service accounts with in-cluster API RBAC capabilities, and launch pods within them.  Specifically, protoform assumes access to oadm (for openshift users) or the ability to define RBAC objects (for kubernetes users).  

Protoform will attempt to detect your cluster type, and bootstrap all necessary components as needed.  This is done via environment variables, but the implementation is highly fluid right now, and we are leaning towards command line options once basic hardening of the core functionality is done.

# CRDs

Run the `hack/update-crds.sh` shell script any time you change the CRDs so that it generates the new CRD autogenerated stuff for you.

# Alternate CRD creation process

## Setup

 1. `mkdir -p $GOPATH/src/k8s.io && cd $GOPATH/src/k8s.io`
 2. `git clone git@github.com:kubernetes/code-generator.git`
 3. `git clone git@github.com:kubernetes/apimachinery.git`
 4. `git clone git@github.com:kubernetes/api.git`

## Generating CRD code

 1. `cd $GOPATH/src/k8s.io/code-generator`
 2. `./generate-groups.sh "deepcopy,client,informer,lister" "github.com/blackducksoftware/perceptor-protoform/pkg/opssight/client" "github.com/blackducksoftware/perceptor-protoform/pkg/api" opssight:v1`